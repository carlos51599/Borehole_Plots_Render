<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Dependency Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
        }
        
        .container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        .controls {
            width: 380px;  /* Increased width for new controls */
            background: white;
            border-right: 2px solid #e9ecef;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 8px rgba(0,0,0,0.1);
        }
        
        .graph-container {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        #graph {
            width: 100%;
            height: 100%;
            background: white;
            cursor: grab;
        }
        
        #graph:active {
            cursor: grabbing;
        }
        
        /* Enhanced node styles */
        .node-rect {
            stroke: #333;
            stroke-width: 1.5;
            rx: 8;
            ry: 8;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
            transition: all 0.2s ease;
        }
        
        .node-rect:hover {
            stroke-width: 2.5;
            filter: drop-shadow(3px 3px 8px rgba(0,0,0,0.3));
        }
        
        .node-rect.highlighted {
            stroke: #ff6600;
            stroke-width: 3;
            filter: drop-shadow(0 0 12px rgba(255,102,0,0.6));
        }
        
        .node-rect.dimmed {
            opacity: 0.3;
        }
        
        /* Enhanced link styles */
        .link {
            fill: none;
            stroke: #666;
            stroke-width: 1.5;
            opacity: 0.8;
            transition: all 0.3s ease;
        }
        
        .link:hover {
            stroke-width: 2.5;
            opacity: 1;
        }
        
        .link.highlighted {
            stroke: #ff6600;
            stroke-width: 3;
            opacity: 1;
        }
        
        .link.dimmed {
            opacity: 0.2;
        }
        
        .link.hidden {
            display: none;
        }
        
        .link.test-related {
            stroke-dasharray: 4,4;
        }
        
        /* Enhanced text styles */
        .node-label {
            font-size: 11px;
            font-weight: 600;
            text-anchor: middle;
            pointer-events: none;
            fill: #333;
        }
        
        .folder-label-text {
            font-size: 9px;
            text-anchor: middle;
            pointer-events: none;
            fill: #666;
            font-style: italic;
        }
        
        /* Control panel styles */
        .section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .section h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .folder-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 4px 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .folder-item:hover {
            background: #e3f2fd;
            border-color: #90caf9;
        }
        
        .folder-checkbox {
            font-size: 16px;
            margin-right: 10px;
            user-select: none;
        }
        
        .folder-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
            border: 1px solid #dee2e6;
        }
        
        .folder-label {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
        }
        
        .folder-count {
            font-weight: normal;
            color: #6c757d;
            font-size: 11px;
        }
        
        .test-count {
            font-weight: normal;
            color: #fd7e14;
            font-size: 11px;
        }
        
        .reset-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s ease;
            width: 100%;
        }
        
        .reset-button:hover {
            background: #0056b3;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .stat-item {
            background: white;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            font-size: 11px;
            color: #6c757d;
            text-transform: uppercase;
        }
        
        /* Tooltip styles */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 6px;
            pointer-events: none;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .importance-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #ffc107;
            border: 2px solid white;
            display: none;
        }
        
        .importance-indicator.high {
            display: block;
            background: #dc3545;
        }
        
        .importance-indicator.medium {
            display: block;
            background: #fd7e14;
        }
        
        .importance-indicator.low {
            display: block;
            background: #ffc107;
        }
        
        /* Layout toggle styles */
        .layout-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .layout-toggle-label {
            font-size: 13px;
            font-weight: 500;
            color: #495057;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background-color: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .toggle-switch.active {
            background-color: #007bff;
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }
        
        .layout-mode-indicator {
            font-size: 11px;
            color: #6c757d;
            margin-top: 5px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <div class="section">
                <h3>üìä Statistics</h3>
                <div id="stats-content" class="stats-grid"></div>
            </div>
            
            <div class="section">
                <h3>üéõÔ∏è Layout Control</h3>
                <div class="layout-toggle" id="layout-toggle">
                    <span class="layout-toggle-label">üìê Hierarchical</span>
                    <div class="toggle-switch" id="toggle-switch">
                        <div class="toggle-slider"></div>
                    </div>
                    <span class="layout-toggle-label">üåê Force-Directed</span>
                </div>
                <div class="layout-mode-indicator" id="layout-indicator">
                    Current: Hierarchical Layout
                </div>
            </div>
            
            <div class="section">
                <h3>üìÅ Directories</h3>
                <div class="folder-item" id="select-all-toggle" role="checkbox" tabindex="0" style="border-bottom: 1px solid #e9ecef; margin-bottom: 10px; padding-bottom: 8px; font-weight: bold;">
                    <span class="folder-checkbox">‚òë</span>
                    <span class="folder-label">Select All Directories</span>
                </div>
                <div id="folder-controls"></div>
            </div>
            
            <div class="section">
                <h3>üîç Advanced Filters</h3>
                <div style="margin-bottom: 15px;">
                    <label for="imports-filter" style="display: block; font-size: 0.9em; margin-bottom: 5px; color: #6c757d;">
                        üì• Max Internal Imports:
                    </label>
                    <input type="range" id="imports-filter" min="0" max="20" value="20" style="width: 100%; margin-bottom: 5px;">
                    <div style="font-size: 0.8em; color: #6c757d; text-align: center;">
                        <span id="imports-filter-value">20</span> imports
                    </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label for="dependencies-filter" style="display: block; font-size: 0.9em; margin-bottom: 5px; color: #6c757d;">
                        üì§ Max Dependencies (outgoing):
                    </label>
                    <input type="range" id="dependencies-filter" min="0" max="20" value="20" style="width: 100%; margin-bottom: 5px;">
                    <div style="font-size: 0.8em; color: #6c757d; text-align: center;">
                        <span id="dependencies-filter-value">20</span> dependencies
                    </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label for="size-filter" style="display: block; font-size: 0.9em; margin-bottom: 5px; color: #6c757d;">
                        üìÑ Max File Size (KB):
                    </label>
                    <input type="range" id="size-filter" min="0" max="100" value="100" style="width: 100%; margin-bottom: 5px;">
                    <div style="font-size: 0.8em; color: #6c757d; text-align: center;">
                        <span id="size-filter-value">100</span> KB
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>üß™ Test Controls</h3>
                <div class="folder-item" id="test-toggle" role="checkbox" tabindex="0">
                    <span class="folder-checkbox">‚òë</span>
                    <span class="folder-label">Show Test Dependencies</span>
                </div>
            </div>
            
            <div class="section">
                <h3>üîß Controls</h3>
                <button class="reset-button" onclick="resetAllFilters()">Reset All Filters</button>
            </div>
        </div>
        
        <div class="graph-container">
            <svg id="graph"></svg>
            <div id="tooltip" class="tooltip" aria-hidden="true"></div>
        </div>
    </div>

    <script>
        // Enhanced graph data with complete directory inclusion
        const graphData = {
  "nodes": [
    {
      "id": "root__app",
      "name": "app",
      "stem": "app",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "app.py",
      "imports_count": 3,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 23005,
      "index": 0
    },
    {
      "id": "root__app_constants",
      "name": "app_constants",
      "stem": "app_constants",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "app_constants.py",
      "imports_count": 0,
      "importance": 0.7442894705540102,
      "is_test": false,
      "is_init": false,
      "size": 8612,
      "index": 1
    },
    {
      "id": "root__app_factory",
      "name": "app_factory",
      "stem": "app_factory",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "app_factory.py",
      "imports_count": 0,
      "importance": 0.26749233841348097,
      "is_test": false,
      "is_init": false,
      "size": 576,
      "index": 2
    },
    {
      "id": "root__borehole_log_professional",
      "name": "borehole_log_professional",
      "stem": "borehole_log_professional",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "borehole_log_professional.py",
      "imports_count": 2,
      "importance": 0.4972969170040625,
      "is_test": false,
      "is_init": false,
      "size": 63204,
      "index": 3
    },
    {
      "id": "root__callbacks_split",
      "name": "callbacks_split",
      "stem": "callbacks_split",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "callbacks_split.py",
      "imports_count": 11,
      "importance": 0.26749233841348097,
      "is_test": false,
      "is_init": false,
      "size": 98589,
      "index": 4
    },
    {
      "id": "root__comprehensive_optimization_validation",
      "name": "comprehensive_optimization_validation",
      "stem": "comprehensive_optimization_validation",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "comprehensive_optimization_validation.py",
      "imports_count": 4,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 24553,
      "index": 5
    },
    {
      "id": "root__config",
      "name": "config",
      "stem": "config",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "config.py",
      "imports_count": 0,
      "importance": 0.42132286877636993,
      "is_test": false,
      "is_init": false,
      "size": 23646,
      "index": 6
    },
    {
      "id": "root__coordinate_service",
      "name": "coordinate_service",
      "stem": "coordinate_service",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "coordinate_service.py",
      "imports_count": 0,
      "importance": 0.8463930548017128,
      "is_test": false,
      "is_init": false,
      "size": 13690,
      "index": 7
    },
    {
      "id": "root__dataframe_optimizer",
      "name": "dataframe_optimizer",
      "stem": "dataframe_optimizer",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "dataframe_optimizer.py",
      "imports_count": 0,
      "importance": 0.27339801341741493,
      "is_test": false,
      "is_init": false,
      "size": 10995,
      "index": 8
    },
    {
      "id": "root__data_loader",
      "name": "data_loader",
      "stem": "data_loader",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "data_loader.py",
      "imports_count": 0,
      "importance": 0.3702264765027494,
      "is_test": false,
      "is_init": false,
      "size": 1730,
      "index": 9
    },
    {
      "id": "root__debug_module",
      "name": "debug_module",
      "stem": "debug_module",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "debug_module.py",
      "imports_count": 1,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 1122,
      "index": 10
    },
    {
      "id": "root__debug_offset_layout",
      "name": "debug_offset_layout",
      "stem": "debug_offset_layout",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "debug_offset_layout.py",
      "imports_count": 1,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 1803,
      "index": 11
    },
    {
      "id": "root__enhanced_error_handling",
      "name": "enhanced_error_handling",
      "stem": "enhanced_error_handling",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "enhanced_error_handling.py",
      "imports_count": 2,
      "importance": 0.252728150903646,
      "is_test": false,
      "is_init": false,
      "size": 12371,
      "index": 12
    },
    {
      "id": "root__error_handling",
      "name": "error_handling",
      "stem": "error_handling",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "error_handling.py",
      "imports_count": 0,
      "importance": 0.39216359844444587,
      "is_test": false,
      "is_init": false,
      "size": 13039,
      "index": 13
    },
    {
      "id": "root__error_recovery",
      "name": "error_recovery",
      "stem": "error_recovery",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "error_recovery.py",
      "imports_count": 1,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 16853,
      "index": 14
    },
    {
      "id": "root__final_validation",
      "name": "final_validation",
      "stem": "final_validation",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "final_validation.py",
      "imports_count": 0,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 3910,
      "index": 15
    },
    {
      "id": "root__geology_code_utils",
      "name": "geology_code_utils",
      "stem": "geology_code_utils",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "geology_code_utils.py",
      "imports_count": 0,
      "importance": 1.0,
      "is_test": false,
      "is_init": false,
      "size": 1795,
      "index": 16
    },
    {
      "id": "root__interactive_validation",
      "name": "interactive_validation",
      "stem": "interactive_validation",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "interactive_validation.py",
      "imports_count": 0,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 22052,
      "index": 17
    },
    {
      "id": "root__lazy_marker_manager",
      "name": "lazy_marker_manager",
      "stem": "lazy_marker_manager",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "lazy_marker_manager.py",
      "imports_count": 0,
      "importance": 0.34991341518713476,
      "is_test": false,
      "is_init": false,
      "size": 16437,
      "index": 18
    },
    {
      "id": "root__loading_indicators",
      "name": "loading_indicators",
      "stem": "loading_indicators",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "loading_indicators.py",
      "imports_count": 1,
      "importance": 0.22910545088790998,
      "is_test": false,
      "is_init": false,
      "size": 14236,
      "index": 19
    },
    {
      "id": "root__map_utils",
      "name": "map_utils",
      "stem": "map_utils",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "map_utils.py",
      "imports_count": 0,
      "importance": 0.25438912199850244,
      "is_test": false,
      "is_init": false,
      "size": 12405,
      "index": 20
    },
    {
      "id": "root__memory_manager",
      "name": "memory_manager",
      "stem": "memory_manager",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "memory_manager.py",
      "imports_count": 2,
      "importance": 0.27339801341741493,
      "is_test": false,
      "is_init": false,
      "size": 14105,
      "index": 21
    },
    {
      "id": "root__migration_validation",
      "name": "migration_validation",
      "stem": "migration_validation",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "migration_validation.py",
      "imports_count": 1,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 8451,
      "index": 22
    },
    {
      "id": "root__options_exploration",
      "name": "options_exploration",
      "stem": "options_exploration",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "options_exploration.py",
      "imports_count": 0,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 19788,
      "index": 23
    },
    {
      "id": "root__polyline_utils",
      "name": "polyline_utils",
      "stem": "polyline_utils",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "polyline_utils.py",
      "imports_count": 1,
      "importance": 0.25438912199850244,
      "is_test": false,
      "is_init": false,
      "size": 15171,
      "index": 24
    },
    {
      "id": "root__section_plot_professional",
      "name": "section_plot_professional",
      "stem": "section_plot_professional",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "section_plot_professional.py",
      "imports_count": 1,
      "importance": 0.4741682020954265,
      "is_test": false,
      "is_init": false,
      "size": 29723,
      "index": 25
    },
    {
      "id": "root__test_force_directed_layout",
      "name": "test_force_directed_layout",
      "stem": "test_force_directed_layout",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "test_force_directed_layout.py",
      "imports_count": 0,
      "importance": 0.208435588374141,
      "is_test": true,
      "is_init": false,
      "size": 7430,
      "index": 26
    },
    {
      "id": "root__test_internal_imports",
      "name": "test_internal_imports",
      "stem": "test_internal_imports",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "test_internal_imports.py",
      "imports_count": 0,
      "importance": 0.208435588374141,
      "is_test": true,
      "is_init": false,
      "size": 6669,
      "index": 27
    },
    {
      "id": "root__validate_features",
      "name": "validate_features",
      "stem": "validate_features",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "validate_features.py",
      "imports_count": 0,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 3453,
      "index": 28
    },
    {
      "id": "root__workspace_audit",
      "name": "workspace_audit",
      "stem": "workspace_audit",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "workspace_audit.py",
      "imports_count": 0,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 5834,
      "index": 29
    },
    {
      "id": "callbacks__base",
      "name": "base (callbacks)",
      "stem": "base",
      "folder": "callbacks",
      "color": "#E8F5E8",
      "file_path": "callbacks\\base.py",
      "imports_count": 0,
      "importance": 0.42169197346411585,
      "is_test": false,
      "is_init": false,
      "size": 1528,
      "index": 30
    },
    {
      "id": "callbacks__file_upload",
      "name": "file_upload (callbacks)",
      "stem": "file_upload",
      "folder": "callbacks",
      "color": "#E8F5E8",
      "file_path": "callbacks\\file_upload.py",
      "imports_count": 6,
      "importance": 0.23796396339381098,
      "is_test": false,
      "is_init": false,
      "size": 17399,
      "index": 31
    },
    {
      "id": "callbacks__map_interactions",
      "name": "map_interactions (callbacks)",
      "stem": "map_interactions",
      "folder": "callbacks",
      "color": "#E8F5E8",
      "file_path": "callbacks\\map_interactions.py",
      "imports_count": 8,
      "importance": 0.23796396339381098,
      "is_test": false,
      "is_init": false,
      "size": 23327,
      "index": 32
    },
    {
      "id": "callbacks__marker_handling",
      "name": "marker_handling (callbacks)",
      "stem": "marker_handling",
      "folder": "callbacks",
      "color": "#E8F5E8",
      "file_path": "callbacks\\marker_handling.py",
      "imports_count": 4,
      "importance": 0.23796396339381098,
      "is_test": false,
      "is_init": false,
      "size": 12731,
      "index": 33
    },
    {
      "id": "callbacks__plot_generation",
      "name": "plot_generation (callbacks)",
      "stem": "plot_generation",
      "folder": "callbacks",
      "color": "#E8F5E8",
      "file_path": "callbacks\\plot_generation.py",
      "imports_count": 6,
      "importance": 0.23796396339381098,
      "is_test": false,
      "is_init": false,
      "size": 11066,
      "index": 34
    },
    {
      "id": "callbacks__search_functionality",
      "name": "search_functionality (callbacks)",
      "stem": "search_functionality",
      "folder": "callbacks",
      "color": "#E8F5E8",
      "file_path": "callbacks\\search_functionality.py",
      "imports_count": 5,
      "importance": 0.23796396339381098,
      "is_test": false,
      "is_init": false,
      "size": 12485,
      "index": 35
    },
    {
      "id": "callbacks____init__",
      "name": "__init__ (callbacks)",
      "stem": "__init__",
      "folder": "callbacks",
      "color": "#E8F5E8",
      "file_path": "callbacks\\__init__.py",
      "imports_count": 6,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": true,
      "size": 4225,
      "index": 36
    },
    {
      "id": "graph_output__enhanced_dependency_graph",
      "name": "enhanced_dependency_graph (graph_output)",
      "stem": "enhanced_dependency_graph",
      "folder": "graph_output",
      "color": "#FAFAFA",
      "file_path": "graph_output\\enhanced_dependency_graph.py",
      "imports_count": 0,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 67690,
      "index": 37
    },
    {
      "id": "graph_output__enhanced_dependency_graph_backup - Copy",
      "name": "enhanced_dependency_graph_backup - Copy (graph_output)",
      "stem": "enhanced_dependency_graph_backup - Copy",
      "folder": "graph_output",
      "color": "#FAFAFA",
      "file_path": "graph_output\\enhanced_dependency_graph_backup - Copy.py",
      "imports_count": 0,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": false,
      "size": 56559,
      "index": 38
    },
    {
      "id": "graph_output__html_dependency_graph",
      "name": "html_dependency_graph (graph_output)",
      "stem": "html_dependency_graph",
      "folder": "graph_output",
      "color": "#FAFAFA",
      "file_path": "graph_output\\html_dependency_graph.py",
      "imports_count": 0,
      "importance": 0.38560583849216085,
      "is_test": false,
      "is_init": false,
      "size": 36597,
      "index": 39
    },
    {
      "id": "state_management__app_state",
      "name": "app_state (state_management)",
      "stem": "app_state",
      "folder": "state_management",
      "color": "#F3E5F5",
      "file_path": "state_management\\app_state.py",
      "imports_count": 1,
      "importance": 0.2970207134331509,
      "is_test": false,
      "is_init": false,
      "size": 10646,
      "index": 40
    },
    {
      "id": "state_management__state_models",
      "name": "state_models (state_management)",
      "stem": "state_models",
      "folder": "state_management",
      "color": "#F3E5F5",
      "file_path": "state_management\\state_models.py",
      "imports_count": 0,
      "importance": 0.5494883198513292,
      "is_test": false,
      "is_init": false,
      "size": 5982,
      "index": 41
    },
    {
      "id": "state_management____init__",
      "name": "__init__ (state_management)",
      "stem": "__init__",
      "folder": "state_management",
      "color": "#F3E5F5",
      "file_path": "state_management\\__init__.py",
      "imports_count": 2,
      "importance": 0.208435588374141,
      "is_test": false,
      "is_init": true,
      "size": 513,
      "index": 42
    }
  ],
  "edges": [
    {
      "source": 0,
      "target": 2,
      "source_name": "root__app",
      "target_name": "root__app_factory",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 0,
      "target": 6,
      "source_name": "root__app",
      "target_name": "root__config",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 0,
      "target": 4,
      "source_name": "root__app",
      "target_name": "root__callbacks_split",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 3,
      "target": 25,
      "source_name": "root__borehole_log_professional",
      "target_name": "root__section_plot_professional",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 3,
      "target": 16,
      "source_name": "root__borehole_log_professional",
      "target_name": "root__geology_code_utils",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 3,
      "source_name": "root__callbacks_split",
      "target_name": "root__borehole_log_professional",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 20,
      "source_name": "root__callbacks_split",
      "target_name": "root__map_utils",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 19,
      "source_name": "root__callbacks_split",
      "target_name": "root__loading_indicators",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 21,
      "source_name": "root__callbacks_split",
      "target_name": "root__memory_manager",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 9,
      "source_name": "root__callbacks_split",
      "target_name": "root__data_loader",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 7,
      "source_name": "root__callbacks_split",
      "target_name": "root__coordinate_service",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 8,
      "source_name": "root__callbacks_split",
      "target_name": "root__dataframe_optimizer",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 6,
      "source_name": "root__callbacks_split",
      "target_name": "root__config",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 24,
      "source_name": "root__callbacks_split",
      "target_name": "root__polyline_utils",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 25,
      "source_name": "root__callbacks_split",
      "target_name": "root__section_plot_professional",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 4,
      "target": 1,
      "source_name": "root__callbacks_split",
      "target_name": "root__app_constants",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 5,
      "target": 12,
      "source_name": "root__comprehensive_optimization_validation",
      "target_name": "root__enhanced_error_handling",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 5,
      "target": 7,
      "source_name": "root__comprehensive_optimization_validation",
      "target_name": "root__coordinate_service",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 5,
      "target": 8,
      "source_name": "root__comprehensive_optimization_validation",
      "target_name": "root__dataframe_optimizer",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 5,
      "target": 21,
      "source_name": "root__comprehensive_optimization_validation",
      "target_name": "root__memory_manager",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 10,
      "target": 16,
      "source_name": "root__debug_module",
      "target_name": "root__geology_code_utils",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 11,
      "target": 3,
      "source_name": "root__debug_offset_layout",
      "target_name": "root__borehole_log_professional",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 12,
      "target": 9,
      "source_name": "root__enhanced_error_handling",
      "target_name": "root__data_loader",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 12,
      "target": 7,
      "source_name": "root__enhanced_error_handling",
      "target_name": "root__coordinate_service",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 14,
      "target": 1,
      "source_name": "root__error_recovery",
      "target_name": "root__app_constants",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 19,
      "target": 1,
      "source_name": "root__loading_indicators",
      "target_name": "root__app_constants",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 21,
      "target": 7,
      "source_name": "root__memory_manager",
      "target_name": "root__coordinate_service",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 21,
      "target": 18,
      "source_name": "root__memory_manager",
      "target_name": "root__lazy_marker_manager",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 22,
      "target": 39,
      "source_name": "root__migration_validation",
      "target_name": "graph_output__html_dependency_graph",
      "source_folder": "root",
      "target_folder": "graph_output",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 24,
      "target": 7,
      "source_name": "root__polyline_utils",
      "target_name": "root__coordinate_service",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 25,
      "target": 16,
      "source_name": "root__section_plot_professional",
      "target_name": "root__geology_code_utils",
      "source_folder": "root",
      "target_folder": "root",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 31,
      "target": 13,
      "source_name": "callbacks__file_upload",
      "target_name": "root__error_handling",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 31,
      "target": 9,
      "source_name": "callbacks__file_upload",
      "target_name": "root__data_loader",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 31,
      "target": 7,
      "source_name": "callbacks__file_upload",
      "target_name": "root__coordinate_service",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 31,
      "target": 6,
      "source_name": "callbacks__file_upload",
      "target_name": "root__config",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 31,
      "target": 30,
      "source_name": "callbacks__file_upload",
      "target_name": "callbacks__base",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 31,
      "target": 1,
      "source_name": "callbacks__file_upload",
      "target_name": "root__app_constants",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 32,
      "target": 13,
      "source_name": "callbacks__map_interactions",
      "target_name": "root__error_handling",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 32,
      "target": 20,
      "source_name": "callbacks__map_interactions",
      "target_name": "root__map_utils",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 32,
      "target": 7,
      "source_name": "callbacks__map_interactions",
      "target_name": "root__coordinate_service",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 32,
      "target": 24,
      "source_name": "callbacks__map_interactions",
      "target_name": "root__polyline_utils",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 32,
      "target": 6,
      "source_name": "callbacks__map_interactions",
      "target_name": "root__config",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 32,
      "target": 30,
      "source_name": "callbacks__map_interactions",
      "target_name": "callbacks__base",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 32,
      "target": 1,
      "source_name": "callbacks__map_interactions",
      "target_name": "root__app_constants",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 32,
      "target": 18,
      "source_name": "callbacks__map_interactions",
      "target_name": "root__lazy_marker_manager",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 33,
      "target": 3,
      "source_name": "callbacks__marker_handling",
      "target_name": "root__borehole_log_professional",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 33,
      "target": 30,
      "source_name": "callbacks__marker_handling",
      "target_name": "callbacks__base",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 33,
      "target": 1,
      "source_name": "callbacks__marker_handling",
      "target_name": "root__app_constants",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 33,
      "target": 13,
      "source_name": "callbacks__marker_handling",
      "target_name": "root__error_handling",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 34,
      "target": 13,
      "source_name": "callbacks__plot_generation",
      "target_name": "root__error_handling",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 34,
      "target": 7,
      "source_name": "callbacks__plot_generation",
      "target_name": "root__coordinate_service",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 34,
      "target": 6,
      "source_name": "callbacks__plot_generation",
      "target_name": "root__config",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 34,
      "target": 25,
      "source_name": "callbacks__plot_generation",
      "target_name": "root__section_plot_professional",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 34,
      "target": 30,
      "source_name": "callbacks__plot_generation",
      "target_name": "callbacks__base",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 34,
      "target": 1,
      "source_name": "callbacks__plot_generation",
      "target_name": "root__app_constants",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 35,
      "target": 3,
      "source_name": "callbacks__search_functionality",
      "target_name": "root__borehole_log_professional",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 35,
      "target": 13,
      "source_name": "callbacks__search_functionality",
      "target_name": "root__error_handling",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 35,
      "target": 7,
      "source_name": "callbacks__search_functionality",
      "target_name": "root__coordinate_service",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 35,
      "target": 6,
      "source_name": "callbacks__search_functionality",
      "target_name": "root__config",
      "source_folder": "callbacks",
      "target_folder": "root",
      "is_cross_folder": true,
      "is_test_related": false
    },
    {
      "source": 35,
      "target": 30,
      "source_name": "callbacks__search_functionality",
      "target_name": "callbacks__base",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 36,
      "target": 33,
      "source_name": "callbacks____init__",
      "target_name": "callbacks__marker_handling",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 36,
      "target": 34,
      "source_name": "callbacks____init__",
      "target_name": "callbacks__plot_generation",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 36,
      "target": 32,
      "source_name": "callbacks____init__",
      "target_name": "callbacks__map_interactions",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 36,
      "target": 31,
      "source_name": "callbacks____init__",
      "target_name": "callbacks__file_upload",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 36,
      "target": 30,
      "source_name": "callbacks____init__",
      "target_name": "callbacks__base",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 36,
      "target": 35,
      "source_name": "callbacks____init__",
      "target_name": "callbacks__search_functionality",
      "source_folder": "callbacks",
      "target_folder": "callbacks",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 40,
      "target": 41,
      "source_name": "state_management__app_state",
      "target_name": "state_management__state_models",
      "source_folder": "state_management",
      "target_folder": "state_management",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 42,
      "target": 41,
      "source_name": "state_management____init__",
      "target_name": "state_management__state_models",
      "source_folder": "state_management",
      "target_folder": "state_management",
      "is_cross_folder": false,
      "is_test_related": false
    },
    {
      "source": 42,
      "target": 40,
      "source_name": "state_management____init__",
      "target_name": "state_management__app_state",
      "source_folder": "state_management",
      "target_folder": "state_management",
      "is_cross_folder": false,
      "is_test_related": false
    }
  ],
  "dependencies": {
    "root__app": {
      "file_path": "app.py",
      "folder": "root",
      "stem": "app",
      "display_name": "app",
      "imports": [
        "root__app_factory",
        "root__config",
        "root__callbacks_split"
      ],
      "all_imports": [
        "config",
        "datetime",
        "dash_leaflet",
        "logging",
        "app_factory",
        "dash",
        "sys",
        "webbrowser",
        "callbacks_split"
      ],
      "imports_count": 9,
      "internal_imports_count": 3,
      "is_test": false,
      "is_init": false,
      "size": 23005
    },
    "root__app_constants": {
      "file_path": "app_constants.py",
      "folder": "root",
      "stem": "app_constants",
      "display_name": "app_constants",
      "imports": [],
      "all_imports": [],
      "imports_count": 0,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 8612
    },
    "root__app_factory": {
      "file_path": "app_factory.py",
      "folder": "root",
      "stem": "app_factory",
      "display_name": "app_factory",
      "imports": [],
      "all_imports": [
        "dash"
      ],
      "imports_count": 1,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 576
    },
    "root__borehole_log_professional": {
      "file_path": "borehole_log_professional.py",
      "folder": "root",
      "stem": "borehole_log_professional",
      "display_name": "borehole_log_professional",
      "imports": [
        "root__section_plot_professional",
        "root__geology_code_utils"
      ],
      "all_imports": [
        "geology_code_utils",
        "section_plot_professional",
        "matplotlib.patches",
        "logging",
        "matplotlib",
        "io",
        "typing",
        "matplotlib.pyplot",
        "textwrap",
        "contextlib",
        "base64",
        "numpy",
        "csv",
        "pandas"
      ],
      "imports_count": 14,
      "internal_imports_count": 2,
      "is_test": false,
      "is_init": false,
      "size": 63204
    },
    "root__callbacks_split": {
      "file_path": "callbacks_split.py",
      "folder": "root",
      "stem": "callbacks_split",
      "display_name": "callbacks_split",
      "imports": [
        "root__borehole_log_professional",
        "root__map_utils",
        "root__loading_indicators",
        "root__memory_manager",
        "root__data_loader",
        "root__coordinate_service",
        "root__dataframe_optimizer",
        "root__config",
        "root__polyline_utils",
        "root__section_plot_professional",
        "root__app_constants"
      ],
      "all_imports": [
        "datetime",
        "statistics",
        "logging",
        "matplotlib",
        "dataframe_optimizer",
        "base64",
        "memory_manager",
        "loading_indicators",
        "config",
        "app_constants",
        "map_utils",
        "traceback",
        "pandas",
        "dash_leaflet",
        "io",
        "matplotlib.pyplot",
        "borehole_log_professional",
        "data_loader",
        "sklearn.decomposition",
        "polyline_utils",
        "section_plot_professional",
        "coordinate_service",
        "dash",
        "numpy"
      ],
      "imports_count": 24,
      "internal_imports_count": 11,
      "is_test": false,
      "is_init": false,
      "size": 98589
    },
    "root__comprehensive_optimization_validation": {
      "file_path": "comprehensive_optimization_validation.py",
      "folder": "root",
      "stem": "comprehensive_optimization_validation",
      "display_name": "comprehensive_optimization_validation",
      "imports": [
        "root__enhanced_error_handling",
        "root__coordinate_service",
        "root__dataframe_optimizer",
        "root__memory_manager"
      ],
      "all_imports": [
        "coordinate_service",
        "logging",
        "enhanced_error_handling",
        "matplotlib",
        "io",
        "matplotlib.pyplot",
        "time",
        "traceback",
        "dataframe_optimizer",
        "memory_manager",
        "sys",
        "numpy",
        "pandas"
      ],
      "imports_count": 13,
      "internal_imports_count": 4,
      "is_test": false,
      "is_init": false,
      "size": 24553
    },
    "root__config": {
      "file_path": "config.py",
      "folder": "root",
      "stem": "config",
      "display_name": "config",
      "imports": [],
      "all_imports": [],
      "imports_count": 0,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 23646
    },
    "root__coordinate_service": {
      "file_path": "coordinate_service.py",
      "folder": "root",
      "stem": "coordinate_service",
      "display_name": "coordinate_service",
      "imports": [],
      "all_imports": [
        "logging",
        "pandas",
        "typing",
        "pyproj",
        "numpy",
        "functools"
      ],
      "imports_count": 6,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 13690
    },
    "root__dataframe_optimizer": {
      "file_path": "dataframe_optimizer.py",
      "folder": "root",
      "stem": "dataframe_optimizer",
      "display_name": "dataframe_optimizer",
      "imports": [],
      "all_imports": [
        "typing",
        "numpy",
        "logging",
        "pandas"
      ],
      "imports_count": 4,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 10995
    },
    "root__data_loader": {
      "file_path": "data_loader.py",
      "folder": "root",
      "stem": "data_loader",
      "display_name": "data_loader",
      "imports": [],
      "all_imports": [
        "os",
        "csv",
        "pandas"
      ],
      "imports_count": 3,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 1730
    },
    "root__debug_module": {
      "file_path": "debug_module.py",
      "folder": "root",
      "stem": "debug_module",
      "display_name": "debug_module",
      "imports": [
        "root__geology_code_utils"
      ],
      "all_imports": [
        "geology_code_utils",
        "matplotlib.patches",
        "logging",
        "typing",
        "matplotlib.pyplot",
        "pandas"
      ],
      "imports_count": 6,
      "internal_imports_count": 1,
      "is_test": false,
      "is_init": false,
      "size": 1122
    },
    "root__debug_offset_layout": {
      "file_path": "debug_offset_layout.py",
      "folder": "root",
      "stem": "debug_offset_layout",
      "display_name": "debug_offset_layout",
      "imports": [
        "root__borehole_log_professional"
      ],
      "all_imports": [
        "sys",
        "borehole_log_professional",
        "logging",
        "traceback"
      ],
      "imports_count": 4,
      "internal_imports_count": 1,
      "is_test": false,
      "is_init": false,
      "size": 1803
    },
    "root__enhanced_error_handling": {
      "file_path": "enhanced_error_handling.py",
      "folder": "root",
      "stem": "enhanced_error_handling",
      "display_name": "enhanced_error_handling",
      "imports": [
        "root__data_loader",
        "root__coordinate_service"
      ],
      "all_imports": [
        "coordinate_service",
        "logging",
        "enum",
        "dataclasses",
        "typing",
        "time",
        "data_loader",
        "functools"
      ],
      "imports_count": 8,
      "internal_imports_count": 2,
      "is_test": false,
      "is_init": false,
      "size": 12371
    },
    "root__error_handling": {
      "file_path": "error_handling.py",
      "folder": "root",
      "stem": "error_handling",
      "display_name": "error_handling",
      "imports": [],
      "all_imports": [
        "datetime",
        "logging",
        "enum",
        "dataclasses",
        "typing",
        "dash",
        "traceback"
      ],
      "imports_count": 7,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 13039
    },
    "root__error_recovery": {
      "file_path": "error_recovery.py",
      "folder": "root",
      "stem": "error_recovery",
      "display_name": "error_recovery",
      "imports": [
        "root__app_constants"
      ],
      "all_imports": [
        "logging",
        "app_constants",
        "typing",
        "time",
        "contextlib",
        "traceback",
        "functools"
      ],
      "imports_count": 7,
      "internal_imports_count": 1,
      "is_test": false,
      "is_init": false,
      "size": 16853
    },
    "root__final_validation": {
      "file_path": "final_validation.py",
      "folder": "root",
      "stem": "final_validation",
      "display_name": "final_validation",
      "imports": [],
      "all_imports": [
        "pathlib",
        "json"
      ],
      "imports_count": 2,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 3910
    },
    "root__geology_code_utils": {
      "file_path": "geology_code_utils.py",
      "folder": "root",
      "stem": "geology_code_utils",
      "display_name": "geology_code_utils",
      "imports": [],
      "all_imports": [
        "os",
        "csv"
      ],
      "imports_count": 2,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 1795
    },
    "root__interactive_validation": {
      "file_path": "interactive_validation.py",
      "folder": "root",
      "stem": "interactive_validation",
      "display_name": "interactive_validation",
      "imports": [],
      "all_imports": [
        "datetime",
        "json",
        "re"
      ],
      "imports_count": 3,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 22052
    },
    "root__lazy_marker_manager": {
      "file_path": "lazy_marker_manager.py",
      "folder": "root",
      "stem": "lazy_marker_manager",
      "display_name": "lazy_marker_manager",
      "imports": [],
      "all_imports": [
        "dash_leaflet",
        "logging",
        "dataclasses",
        "typing",
        "pandas"
      ],
      "imports_count": 5,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 16437
    },
    "root__loading_indicators": {
      "file_path": "loading_indicators.py",
      "folder": "root",
      "stem": "loading_indicators",
      "display_name": "loading_indicators",
      "imports": [
        "root__app_constants"
      ],
      "all_imports": [
        "time",
        "app_constants",
        "dash",
        "typing"
      ],
      "imports_count": 4,
      "internal_imports_count": 1,
      "is_test": false,
      "is_init": false,
      "size": 14236
    },
    "root__map_utils": {
      "file_path": "map_utils.py",
      "folder": "root",
      "stem": "map_utils",
      "display_name": "map_utils",
      "imports": [],
      "all_imports": [
        "shapely.geometry",
        "logging",
        "pyproj",
        "shapely.ops",
        "pandas"
      ],
      "imports_count": 5,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 12405
    },
    "root__memory_manager": {
      "file_path": "memory_manager.py",
      "folder": "root",
      "stem": "memory_manager",
      "display_name": "memory_manager",
      "imports": [
        "root__coordinate_service",
        "root__lazy_marker_manager"
      ],
      "all_imports": [
        "datetime",
        "gc",
        "coordinate_service",
        "logging",
        "lazy_marker_manager",
        "typing",
        "dataclasses",
        "psutil",
        "sys",
        "pandas"
      ],
      "imports_count": 10,
      "internal_imports_count": 2,
      "is_test": false,
      "is_init": false,
      "size": 14105
    },
    "root__migration_validation": {
      "file_path": "migration_validation.py",
      "folder": "root",
      "stem": "migration_validation",
      "display_name": "migration_validation",
      "imports": [
        "graph_output__html_dependency_graph"
      ],
      "all_imports": [
        "os",
        "json",
        "time",
        "html_dependency_graph",
        "sys"
      ],
      "imports_count": 5,
      "internal_imports_count": 1,
      "is_test": false,
      "is_init": false,
      "size": 8451
    },
    "root__options_exploration": {
      "file_path": "options_exploration.py",
      "folder": "root",
      "stem": "options_exploration",
      "display_name": "options_exploration",
      "imports": [],
      "all_imports": [
        "json",
        "math"
      ],
      "imports_count": 2,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 19788
    },
    "root__polyline_utils": {
      "file_path": "polyline_utils.py",
      "folder": "root",
      "stem": "polyline_utils",
      "display_name": "polyline_utils",
      "imports": [
        "root__coordinate_service"
      ],
      "all_imports": [
        "shapely.geometry",
        "dash_leaflet",
        "logging",
        "coordinate_service",
        "numpy",
        "pyproj",
        "shapely.ops",
        "pandas"
      ],
      "imports_count": 8,
      "internal_imports_count": 1,
      "is_test": false,
      "is_init": false,
      "size": 15171
    },
    "root__section_plot_professional": {
      "file_path": "section_plot_professional.py",
      "folder": "root",
      "stem": "section_plot_professional",
      "display_name": "section_plot_professional",
      "imports": [
        "root__geology_code_utils"
      ],
      "all_imports": [
        "geology_code_utils",
        "shapely.geometry",
        "matplotlib.patches",
        "logging",
        "matplotlib",
        "io",
        "typing",
        "matplotlib.pyplot",
        "contextlib",
        "base64",
        "matplotlib.ticker",
        "pyproj",
        "numpy",
        "csv",
        "re",
        "pandas"
      ],
      "imports_count": 16,
      "internal_imports_count": 1,
      "is_test": false,
      "is_init": false,
      "size": 29723
    },
    "root__test_force_directed_layout": {
      "file_path": "test_force_directed_layout.py",
      "folder": "root",
      "stem": "test_force_directed_layout",
      "display_name": "test_force_directed_layout",
      "imports": [],
      "all_imports": [
        "os",
        "pathlib",
        "re"
      ],
      "imports_count": 3,
      "internal_imports_count": 0,
      "is_test": true,
      "is_init": false,
      "size": 7430
    },
    "root__test_internal_imports": {
      "file_path": "test_internal_imports.py",
      "folder": "root",
      "stem": "test_internal_imports",
      "display_name": "test_internal_imports",
      "imports": [],
      "all_imports": [
        "ast",
        "json",
        "typing",
        "pathlib"
      ],
      "imports_count": 4,
      "internal_imports_count": 0,
      "is_test": true,
      "is_init": false,
      "size": 6669
    },
    "root__validate_features": {
      "file_path": "validate_features.py",
      "folder": "root",
      "stem": "validate_features",
      "display_name": "validate_features",
      "imports": [],
      "all_imports": [
        "os",
        "pathlib",
        "json"
      ],
      "imports_count": 3,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 3453
    },
    "root__workspace_audit": {
      "file_path": "workspace_audit.py",
      "folder": "root",
      "stem": "workspace_audit",
      "display_name": "workspace_audit",
      "imports": [],
      "all_imports": [
        "ast",
        "json",
        "typing",
        "pathlib"
      ],
      "imports_count": 4,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 5834
    },
    "callbacks__base": {
      "file_path": "callbacks\\base.py",
      "folder": "callbacks",
      "stem": "base",
      "display_name": "base (callbacks)",
      "imports": [],
      "all_imports": [
        "abc",
        "logging"
      ],
      "imports_count": 2,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 1528
    },
    "callbacks__file_upload": {
      "file_path": "callbacks\\file_upload.py",
      "folder": "callbacks",
      "stem": "file_upload",
      "display_name": "file_upload (callbacks)",
      "imports": [
        "root__error_handling",
        "root__data_loader",
        "root__coordinate_service",
        "root__config",
        "callbacks__base",
        "root__app_constants"
      ],
      "all_imports": [
        "base",
        "datetime",
        "config",
        "coordinate_service",
        "statistics",
        "logging",
        "dash_leaflet",
        "app_constants",
        "typing",
        "error_handling",
        "state_management",
        "dash",
        "base64",
        "data_loader",
        "pandas"
      ],
      "imports_count": 15,
      "internal_imports_count": 6,
      "is_test": false,
      "is_init": false,
      "size": 17399
    },
    "callbacks__map_interactions": {
      "file_path": "callbacks\\map_interactions.py",
      "folder": "callbacks",
      "stem": "map_interactions",
      "display_name": "map_interactions (callbacks)",
      "imports": [
        "root__error_handling",
        "root__map_utils",
        "root__coordinate_service",
        "root__polyline_utils",
        "root__config",
        "callbacks__base",
        "root__app_constants",
        "root__lazy_marker_manager"
      ],
      "all_imports": [
        "base",
        "datetime",
        "config",
        "dash_leaflet",
        "logging",
        "coordinate_service",
        "lazy_marker_manager",
        "app_constants",
        "typing",
        "error_handling",
        "map_utils",
        "state_management",
        "dash",
        "sklearn.decomposition",
        "polyline_utils",
        "pandas"
      ],
      "imports_count": 16,
      "internal_imports_count": 8,
      "is_test": false,
      "is_init": false,
      "size": 23327
    },
    "callbacks__marker_handling": {
      "file_path": "callbacks\\marker_handling.py",
      "folder": "callbacks",
      "stem": "marker_handling",
      "display_name": "marker_handling (callbacks)",
      "imports": [
        "root__borehole_log_professional",
        "callbacks__base",
        "root__app_constants",
        "root__error_handling"
      ],
      "all_imports": [
        "base",
        "dash_leaflet",
        "logging",
        "app_constants",
        "error_handling",
        "state_management",
        "dash",
        "borehole_log_professional",
        "pandas"
      ],
      "imports_count": 9,
      "internal_imports_count": 4,
      "is_test": false,
      "is_init": false,
      "size": 12731
    },
    "callbacks__plot_generation": {
      "file_path": "callbacks\\plot_generation.py",
      "folder": "callbacks",
      "stem": "plot_generation",
      "display_name": "plot_generation (callbacks)",
      "imports": [
        "root__error_handling",
        "root__coordinate_service",
        "root__config",
        "root__section_plot_professional",
        "callbacks__base",
        "root__app_constants"
      ],
      "all_imports": [
        "base",
        "datetime",
        "config",
        "section_plot_professional",
        "coordinate_service",
        "logging",
        "shapely.geometry",
        "io",
        "app_constants",
        "error_handling",
        "matplotlib.pyplot",
        "state_management",
        "dash",
        "base64",
        "pandas"
      ],
      "imports_count": 15,
      "internal_imports_count": 6,
      "is_test": false,
      "is_init": false,
      "size": 11066
    },
    "callbacks__search_functionality": {
      "file_path": "callbacks\\search_functionality.py",
      "folder": "callbacks",
      "stem": "search_functionality",
      "display_name": "search_functionality (callbacks)",
      "imports": [
        "root__borehole_log_professional",
        "root__error_handling",
        "root__coordinate_service",
        "root__config",
        "callbacks__base"
      ],
      "all_imports": [
        "base",
        "config",
        "coordinate_service",
        "logging",
        "error_handling",
        "state_management",
        "dash",
        "borehole_log_professional",
        "pandas"
      ],
      "imports_count": 9,
      "internal_imports_count": 5,
      "is_test": false,
      "is_init": false,
      "size": 12485
    },
    "callbacks____init__": {
      "file_path": "callbacks\\__init__.py",
      "folder": "callbacks",
      "stem": "__init__",
      "display_name": "__init__ (callbacks)",
      "imports": [
        "callbacks__marker_handling",
        "callbacks__plot_generation",
        "callbacks__map_interactions",
        "callbacks__file_upload",
        "callbacks__base",
        "callbacks__search_functionality"
      ],
      "all_imports": [
        "base",
        "logging",
        "file_upload",
        "marker_handling",
        "typing",
        "plot_generation",
        "search_functionality",
        "map_interactions"
      ],
      "imports_count": 8,
      "internal_imports_count": 6,
      "is_test": false,
      "is_init": true,
      "size": 4225
    },
    "graph_output__enhanced_dependency_graph": {
      "file_path": "graph_output\\enhanced_dependency_graph.py",
      "folder": "graph_output",
      "stem": "enhanced_dependency_graph",
      "display_name": "enhanced_dependency_graph (graph_output)",
      "imports": [],
      "all_imports": [
        "os",
        "ast",
        "pathlib",
        "json",
        "typing"
      ],
      "imports_count": 5,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 67690
    },
    "graph_output__enhanced_dependency_graph_backup - Copy": {
      "file_path": "graph_output\\enhanced_dependency_graph_backup - Copy.py",
      "folder": "graph_output",
      "stem": "enhanced_dependency_graph_backup - Copy",
      "display_name": "enhanced_dependency_graph_backup - Copy (graph_output)",
      "imports": [],
      "all_imports": [
        "os",
        "ast",
        "pathlib",
        "json",
        "typing"
      ],
      "imports_count": 5,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 56559
    },
    "graph_output__html_dependency_graph": {
      "file_path": "graph_output\\html_dependency_graph.py",
      "folder": "graph_output",
      "stem": "html_dependency_graph",
      "display_name": "html_dependency_graph (graph_output)",
      "imports": [],
      "all_imports": [
        "os",
        "ast",
        "pathlib",
        "json",
        "typing"
      ],
      "imports_count": 5,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 36597
    },
    "state_management__app_state": {
      "file_path": "state_management\\app_state.py",
      "folder": "state_management",
      "stem": "app_state",
      "display_name": "app_state (state_management)",
      "imports": [
        "state_management__state_models"
      ],
      "all_imports": [
        "datetime",
        "logging",
        "threading",
        "typing",
        "state_models",
        "pandas"
      ],
      "imports_count": 6,
      "internal_imports_count": 1,
      "is_test": false,
      "is_init": false,
      "size": 10646
    },
    "state_management__state_models": {
      "file_path": "state_management\\state_models.py",
      "folder": "state_management",
      "stem": "state_models",
      "display_name": "state_models (state_management)",
      "imports": [],
      "all_imports": [
        "datetime",
        "typing",
        "dataclasses",
        "pandas"
      ],
      "imports_count": 4,
      "internal_imports_count": 0,
      "is_test": false,
      "is_init": false,
      "size": 5982
    },
    "state_management____init__": {
      "file_path": "state_management\\__init__.py",
      "folder": "state_management",
      "stem": "__init__",
      "display_name": "__init__ (state_management)",
      "imports": [
        "state_management__state_models",
        "state_management__app_state"
      ],
      "all_imports": [
        "state_models",
        "app_state"
      ],
      "imports_count": 2,
      "internal_imports_count": 2,
      "is_test": false,
      "is_init": true,
      "size": 513
    }
  },
  "subfolder_info": {
    "root": {
      "color": "#E3F2FD",
      "modules": [
        "app",
        "app_constants",
        "app_factory",
        "borehole_log_professional",
        "callbacks_split",
        "comprehensive_optimization_validation",
        "config",
        "coordinate_service",
        "dataframe_optimizer",
        "data_loader",
        "debug_module",
        "debug_offset_layout",
        "enhanced_error_handling",
        "error_handling",
        "error_recovery",
        "final_validation",
        "geology_code_utils",
        "interactive_validation",
        "lazy_marker_manager",
        "loading_indicators",
        "map_utils",
        "memory_manager",
        "migration_validation",
        "options_exploration",
        "polyline_utils",
        "section_plot_professional",
        "test_force_directed_layout",
        "test_internal_imports",
        "validate_features",
        "workspace_audit"
      ],
      "test_modules": [
        "test_force_directed_layout",
        "test_internal_imports"
      ],
      "count": 30
    },
    "archive": {
      "color": "#FFEBEE",
      "modules": [],
      "test_modules": [],
      "count": 0
    },
    "callbacks": {
      "color": "#E8F5E8",
      "modules": [
        "base (callbacks)",
        "file_upload (callbacks)",
        "map_interactions (callbacks)",
        "marker_handling (callbacks)",
        "plot_generation (callbacks)",
        "search_functionality (callbacks)",
        "__init__ (callbacks)"
      ],
      "test_modules": [],
      "count": 7
    },
    "flowchart_visualization": {
      "color": "#E0F2F1",
      "modules": [],
      "test_modules": [],
      "count": 0
    },
    "graph_output": {
      "color": "#FAFAFA",
      "modules": [
        "enhanced_dependency_graph (graph_output)",
        "enhanced_dependency_graph_backup - Copy (graph_output)",
        "html_dependency_graph (graph_output)"
      ],
      "test_modules": [],
      "count": 3
    },
    "old_streamlit_files": {
      "color": "#FFF8E1",
      "modules": [],
      "test_modules": [],
      "count": 0
    },
    "state_management": {
      "color": "#F3E5F5",
      "modules": [
        "app_state (state_management)",
        "state_models (state_management)",
        "__init__ (state_management)"
      ],
      "test_modules": [],
      "count": 3
    },
    "tests": {
      "color": "#FFF3E0",
      "modules": [],
      "test_modules": [],
      "count": 0
    },
    "assets": {
      "color": "#F1F8E9",
      "modules": [],
      "test_modules": [],
      "count": 0
    },
    "reports": {
      "color": "#FCE4EC",
      "modules": [],
      "test_modules": [],
      "count": 0
    }
  },
  "importance_scores": {
    "root__app": 0.208435588374141,
    "root__app_constants": 0.7442894705540102,
    "root__app_factory": 0.26749233841348097,
    "root__borehole_log_professional": 0.4972969170040625,
    "root__callbacks_split": 0.26749233841348097,
    "root__comprehensive_optimization_validation": 0.208435588374141,
    "root__config": 0.42132286877636993,
    "root__coordinate_service": 0.8463930548017128,
    "root__dataframe_optimizer": 0.27339801341741493,
    "root__data_loader": 0.3702264765027494,
    "root__debug_module": 0.208435588374141,
    "root__debug_offset_layout": 0.208435588374141,
    "root__enhanced_error_handling": 0.252728150903646,
    "root__error_handling": 0.39216359844444587,
    "root__error_recovery": 0.208435588374141,
    "root__final_validation": 0.208435588374141,
    "root__geology_code_utils": 1.0,
    "root__interactive_validation": 0.208435588374141,
    "root__lazy_marker_manager": 0.34991341518713476,
    "root__loading_indicators": 0.22910545088790998,
    "root__map_utils": 0.25438912199850244,
    "root__memory_manager": 0.27339801341741493,
    "root__migration_validation": 0.208435588374141,
    "root__options_exploration": 0.208435588374141,
    "root__polyline_utils": 0.25438912199850244,
    "root__section_plot_professional": 0.4741682020954265,
    "root__test_force_directed_layout": 0.208435588374141,
    "root__test_internal_imports": 0.208435588374141,
    "root__validate_features": 0.208435588374141,
    "root__workspace_audit": 0.208435588374141,
    "callbacks__base": 0.42169197346411585,
    "callbacks__file_upload": 0.23796396339381098,
    "callbacks__map_interactions": 0.23796396339381098,
    "callbacks__marker_handling": 0.23796396339381098,
    "callbacks__plot_generation": 0.23796396339381098,
    "callbacks__search_functionality": 0.23796396339381098,
    "callbacks____init__": 0.208435588374141,
    "graph_output__enhanced_dependency_graph": 0.208435588374141,
    "graph_output__enhanced_dependency_graph_backup - Copy": 0.208435588374141,
    "graph_output__html_dependency_graph": 0.38560583849216085,
    "state_management__app_state": 0.2970207134331509,
    "state_management__state_models": 0.5494883198513292,
    "state_management____init__": 0.208435588374141
  },
  "statistics": {
    "total_files": 43,
    "total_dependencies": 69,
    "cross_folder_dependencies": 25,
    "test_files": 2,
    "folders": 10
  }
};
        
        // Enhanced state management
        let checkedFolders = new Set(Object.keys(graphData.subfolder_info));
        let showTestDependencies = true;
        let selectedNode = null;
        let highlightedNodes = new Set();
        
        // Layout state management
        let currentLayout = "hierarchical"; // "hierarchical" or "force"
        let simulation = null;
        
        // Advanced filter state
        let maxImportsFilter = 20;
        let maxDependenciesFilter = 20;
        let maxSizeFilter = 100; // KB
        
        // D3.js setup with enhanced features
        const svg = d3.select("#graph");
        const tooltip = d3.select("#tooltip");
        let width, height;
        
        function updateDimensions() {
            const container = document.querySelector('.graph-container');
            width = container.clientWidth;
            height = container.clientHeight;
            svg.attr("width", width).attr("height", height);
        }
        
        // Enhanced layout calculation with dependency-aware positioning
        function calculateEnhancedHierarchicalLayout() {
            console.log("üîß Enhanced layout calculation starting...");
            
            // Calculate node dimensions with importance weighting
            graphData.nodes.forEach(d => {
                const importance = d.importance || 0;
                const baseWidth = Math.max(120, d.stem.length * 8 + 20);
                const baseHeight = d.folder !== "root" ? 40 : 30;
                
                // Scale size based on importance
                const importanceScale = 1 + (importance * 0.5);
                d.width = Math.round(baseWidth * importanceScale);
                d.height = Math.round(baseHeight * importanceScale);
            });
            
            // Build enhanced adjacency maps
            const incomingEdges = new Map();
            const outgoingEdges = new Map();
            const importanceWeights = new Map();
            
            graphData.nodes.forEach(node => {
                incomingEdges.set(node.index, []);
                outgoingEdges.set(node.index, []);
                importanceWeights.set(node.index, node.importance || 0);
            });
            
            graphData.edges.forEach(edge => {
                if (shouldShowEdge(edge)) {
                    incomingEdges.get(edge.target).push(edge.source);
                    outgoingEdges.get(edge.source).push(edge.target);
                }
            });
            
            // Enhanced layer assignment with importance consideration
            const levels = [];
            const nodeToLevel = new Map();
            const visited = new Set();
            const inDegree = new Map();
            
            // Calculate weighted in-degrees
            graphData.nodes.forEach(node => {
                const edges = incomingEdges.get(node.index);
                let weightedDegree = 0;
                
                for (const sourceIdx of edges) {
                    const sourceImportance = importanceWeights.get(sourceIdx) || 0;
                    weightedDegree += 1 + sourceImportance;
                }
                
                inDegree.set(node.index, weightedDegree);
            });
            
            // Process nodes level by level
            let currentLevel = 0;
            while (visited.size < graphData.nodes.length) {
                levels[currentLevel] = [];
                
                // Find nodes for current level
                const candidateNodes = [];
                for (const node of graphData.nodes) {
                    if (!visited.has(node.index) && inDegree.get(node.index) === 0) {
                        candidateNodes.push(node);
                    }
                }
                
                // If no zero in-degree nodes, pick highest importance unvisited nodes
                if (candidateNodes.length === 0) {
                    const remainingNodes = graphData.nodes.filter(n => !visited.has(n.index));
                    if (remainingNodes.length > 0) {
                        // Sort by importance descending, then by in-degree ascending
                        remainingNodes.sort((a, b) => {
                            const importanceDiff = (b.importance || 0) - (a.importance || 0);
                            if (Math.abs(importanceDiff) > 0.01) return importanceDiff;
                            return inDegree.get(a.index) - inDegree.get(b.index);
                        });
                        
                        candidateNodes.push(remainingNodes[0]);
                    }
                }
                
                // Sort candidates by importance within level
                candidateNodes.sort((a, b) => (b.importance || 0) - (a.importance || 0));
                
                for (const node of candidateNodes) {
                    levels[currentLevel].push(node.index);
                    nodeToLevel.set(node.index, currentLevel);
                    visited.add(node.index);
                    
                    // Update in-degrees
                    for (const targetIdx of outgoingEdges.get(node.index)) {
                        if (!visited.has(targetIdx)) {
                            const currentDegree = inDegree.get(targetIdx);
                            const nodeImportance = node.importance || 0;
                            inDegree.set(targetIdx, Math.max(0, currentDegree - (1 + nodeImportance)));
                        }
                    }
                }
                
                currentLevel++;
                if (currentLevel > graphData.nodes.length) break; // Safety
            }
            
            console.log(`‚úÖ Created ${levels.length} levels with enhanced positioning`);
            
            // Enhanced position assignment
            const margin = 60;
            const levelWidth = Math.max(300, (width - 2 * margin) / Math.max(1, levels.length));
            const nodeSpacing = 45;
            
            levels.forEach((level, levelIndex) => {
                const x = margin + levelIndex * levelWidth;
                
                // Sort nodes in level by importance (highest first)
                const sortedLevelNodes = level
                    .map(nodeIdx => graphData.nodes[nodeIdx])
                    .sort((a, b) => (b.importance || 0) - (a.importance || 0));
                
                const totalHeight = sortedLevelNodes.length * nodeSpacing;
                const startY = Math.max(margin, (height - totalHeight) / 2);
                
                sortedLevelNodes.forEach((node, positionIndex) => {
                    node.x = x;
                    node.y = startY + positionIndex * nodeSpacing;
                });
            });
            
            return { levels, nodeToLevel };
        }
        
        // Force-directed layout using D3 force simulation
        function initializeForceDirectedLayout() {
            console.log("üåê Initializing force-directed layout...");
            
            // Calculate node dimensions for force layout
            graphData.nodes.forEach(d => {
                const importance = d.importance || 0;
                const baseWidth = Math.max(120, d.stem.length * 8 + 20);
                const baseHeight = d.folder !== "root" ? 40 : 30;
                
                // Scale size based on importance
                const importanceScale = 1 + (importance * 0.5);
                d.width = Math.round(baseWidth * importanceScale);
                d.height = Math.round(baseHeight * importanceScale);
                
                // Set initial positions if not set
                if (d.x === undefined) d.x = width / 2 + (Math.random() - 0.5) * 200;
                if (d.y === undefined) d.y = height / 2 + (Math.random() - 0.5) * 200;
            });
            
            // Create filtered links for simulation
            const validLinks = graphData.edges
                .filter(edge => shouldShowEdge(edge))
                .map(edge => ({
                    source: edge.source,
                    target: edge.target,
                    strength: 0.5 + (graphData.nodes[edge.source]?.importance || 0) * 0.3
                }));
            
            // Stop any existing simulation
            if (simulation) {
                simulation.stop();
            }
            
            // Create force simulation
            simulation = d3.forceSimulation(graphData.nodes)
                .force("link", d3.forceLink(validLinks)
                    .id(d => d.index)
                    .distance(d => {
                        const sourceNode = graphData.nodes[d.source.index || d.source];
                        const targetNode = graphData.nodes[d.target.index || d.target];
                        const baseDistance = 150;
                        const importanceBonus = ((sourceNode?.importance || 0) + (targetNode?.importance || 0)) * 50;
                        return baseDistance + importanceBonus;
                    })
                    .strength(d => d.strength || 0.5)
                )
                .force("charge", d3.forceManyBody()
                    .strength(d => {
                        const importance = d.importance || 0;
                        const baseCharge = -800;
                        const importanceMultiplier = 1 + importance * 2;
                        return baseCharge * importanceMultiplier;
                    })
                )
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide()
                    .radius(d => Math.max(d.width, d.height) / 2 + 10)
                    .strength(0.7)
                )
                .force("x", d3.forceX(width / 2).strength(0.1))
                .force("y", d3.forceY(height / 2).strength(0.1));
            
            // Update positions during simulation
            simulation.on("tick", () => {
                updatePositionsForceLayout();
            });
            
            // Reduce alpha target for smoother convergence
            simulation.alphaTarget(0.1).restart();
            
            console.log("‚úÖ Force-directed layout initialized");
            return simulation;
        }
        
        // Update positions for force layout
        function updatePositionsForceLayout() {
            if (!window.graphElements) return;
            
            const { node, link } = window.graphElements;
            
            // Update node positions
            node.attr("transform", d => `translate(${d.x},${d.y})`);
            
            // Update link paths with force layout positions
            link.attr("d", d => {
                const source = d.source.x !== undefined ? d.source : graphData.nodes[d.source];
                const target = d.target.x !== undefined ? d.target : graphData.nodes[d.target];
                
                if (!source || !target) return "";
                
                return createEnhancedCubicBezierPath({
                    source: source.index,
                    target: target.index
                });
            });
        }
        
        // Enhanced cubic B√©zier curve generation
        function createEnhancedCubicBezierPath(d) {
            const source = graphData.nodes[d.source];
            const target = graphData.nodes[d.target];
            
            const sourceX = source.x + source.width/2;
            const sourceY = source.y;
            const targetX = target.x - target.width/2;
            const targetY = target.y;
            
            const dx = targetX - sourceX;
            const dy = targetY - sourceY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // Adaptive control point calculation
            const curveFactor = Math.min(0.6, Math.max(0.2, distance / 400));
            const offsetFactor = Math.abs(dy) / 100;
            
            // Control points for smooth cubic B√©zier
            const cp1x = sourceX + dx * 0.3 + offsetFactor * 20;
            const cp1y = sourceY + dy * 0.1;
            const cp2x = targetX - dx * 0.3 - offsetFactor * 20;
            const cp2y = targetY - dy * 0.1;
            
            return `M${sourceX},${sourceY} C${cp1x},${cp1y} ${cp2x},${cp2y} ${targetX},${targetY}`;
        }
        
        // Switch between hierarchical and force-directed layouts
        function switchLayout(newLayout) {
            if (newLayout === currentLayout) return;
            
            console.log(`üîÑ Switching from ${currentLayout} to ${newLayout} layout`);
            currentLayout = newLayout;
            
            // Update toggle UI
            const toggleSwitch = document.getElementById('toggle-switch');
            const layoutIndicator = document.getElementById('layout-indicator');
            
            if (newLayout === "force") {
                toggleSwitch.classList.add('active');
                layoutIndicator.textContent = "Current: Force-Directed Layout";
                
                // Initialize force-directed layout
                initializeForceDirectedLayout();
                
            } else {
                toggleSwitch.classList.remove('active');
                layoutIndicator.textContent = "Current: Hierarchical Layout";
                
                // Stop force simulation
                if (simulation) {
                    simulation.stop();
                    simulation = null;
                }
                
                // Recalculate hierarchical layout
                const layout = calculateEnhancedHierarchicalLayout();
                
                // Animate to hierarchical positions
                animateToHierarchicalLayout();
            }
        }
        
        // Animate nodes to hierarchical positions
        function animateToHierarchicalLayout() {
            if (!window.graphElements) return;
            
            const { node, link } = window.graphElements;
            
            // Animate nodes to hierarchical positions
            node.transition()
                .duration(1000)
                .ease(d3.easeQuadInOut)
                .attr("transform", d => `translate(${d.x},${d.y})`);
            
            // Animate links to hierarchical curves
            link.transition()
                .duration(1000)
                .ease(d3.easeQuadInOut)
                .attr("d", d => createEnhancedCubicBezierPath(d));
        }
        
        // Setup layout toggle functionality
        function setupLayoutToggle() {
            const toggleSwitch = document.getElementById('toggle-switch');
            const layoutToggle = document.getElementById('layout-toggle');
            
            function handleToggle() {
                const newLayout = currentLayout === "hierarchical" ? "force" : "hierarchical";
                switchLayout(newLayout);
            }
            
            toggleSwitch.addEventListener('click', handleToggle);
            layoutToggle.addEventListener('click', function(event) {
                if (event.target === toggleSwitch || event.target.closest('.toggle-switch')) {
                    return; // Let the toggle switch handle it
                }
                handleToggle();
            });
            
            // Keyboard accessibility
            toggleSwitch.addEventListener('keydown', function(event) {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    handleToggle();
                }
            });
            
            toggleSwitch.setAttribute('tabindex', '0');
            toggleSwitch.setAttribute('role', 'switch');
            toggleSwitch.setAttribute('aria-checked', 'false');
        }
        
        // Enhanced visibility logic
        function shouldShowEdge(edge) {
        function shouldShowEdge(edge) {
            // Get source and target nodes
            const sourceNode = graphData.nodes.find(n => n.id === edge.source_name);
            const targetNode = graphData.nodes.find(n => n.id === edge.target_name);
            
            // Both nodes must be visible
            if (!sourceNode || !targetNode) return false;
            if (!shouldShowNode(sourceNode) || !shouldShowNode(targetNode)) return false;
            
            // Check test dependencies filter
            if (!showTestDependencies && edge.is_test_related) {
                return false;
            }
            
            return true;
        }
        
        // Initialize enhanced visualization
        function initializeEnhancedVisualization() {
            updateDimensions();
            svg.selectAll("*").remove();
            
            const g = svg.append("g").attr("id", "main-group");
            
            // Enhanced zoom with better constraints
            const zoom = d3.zoom()
                .scaleExtent([0.1, 8])
                .on("zoom", (event) => {
                    g.attr("transform", event.transform);
                });
            
            svg.call(zoom);
            
            // Calculate enhanced layout
            const layout = calculateEnhancedHierarchicalLayout();
            
            // Create enhanced arrow markers
            createEnhancedArrowMarkers();
            
            // Create enhanced links with cubic B√©zier curves
            const linkGroup = g.append("g").attr("class", "links");
            const link = linkGroup.selectAll("path")
                .data(graphData.edges)
                .enter().append("path")
                .attr("class", d => {
                    let classes = "link";
                    if (d.is_test_related) classes += " test-related";
                    return classes;
                })
                .attr("d", d => createEnhancedCubicBezierPath(d))
                .attr("marker-end", "url(#arrowhead)");
            
            // Create enhanced node groups
            const nodeGroup = g.append("g").attr("class", "nodes");
            const node = nodeGroup.selectAll("g")
                .data(graphData.nodes)
                .enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.x},${d.y})`)
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));
            
            // Enhanced rectangles with importance indicators
            const rect = node.append("rect")
                .attr("class", "node-rect")
                .attr("width", d => d.width)
                .attr("height", d => d.height)
                .attr("x", d => -d.width/2)
                .attr("y", d => -d.height/2)
                .attr("fill", d => d.color);
            
            // Importance indicators
            node.filter(d => d.importance > 0.3)
                .append("circle")
                .attr("class", d => {
                    if (d.importance > 0.7) return "importance-indicator high";
                    if (d.importance > 0.5) return "importance-indicator medium";
                    return "importance-indicator low";
                })
                .attr("cx", d => d.width/2 - 8)
                .attr("cy", d => -d.height/2 + 8)
                .attr("r", 6);
            
            // Enhanced text labels
            node.append("text")
                .attr("class", "node-label")
                .text(d => d.stem)
                .attr("dy", "-2px");
            
            node.filter(d => d.folder !== "root")
                .append("text")
                .attr("class", "folder-label-text")
                .text(d => `(${d.folder})`)
                .attr("dy", "10px");
            
            // Enhanced event listeners
            node.on("click", handleEnhancedNodeClick)
                .on("mouseover", handleEnhancedMouseOver)
                .on("mouseout", handleEnhancedMouseOut);
            
            svg.on("click", function(event) {
                if (event.target === this) {
                    resetHighlighting();
                }
            });
            
            window.graphElements = { node, link, g };
            
            setupLayoutToggle();
            setupAdvancedFilters();
            updateEnhancedControls();
            updateEnhancedStats();
            updateEnhancedVisibility();
        }
        
        // Enhanced arrow markers
        function createEnhancedArrowMarkers() {
            const defs = svg.select("defs").empty() ? svg.append("defs") : svg.select("defs");
            
            // Standard arrow
            defs.append("marker")
                .attr("id", "arrowhead")
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", 8)
                .attr("refY", 0)
                .attr("markerWidth", 8)
                .attr("markerHeight", 8)
                .attr("orient", "auto")
                .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .attr("fill", "#666");
            
            // Highlighted arrow
            defs.append("marker")
                .attr("id", "arrowhead-highlighted")
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", 8)
                .attr("refY", 0)
                .attr("markerWidth", 8)
                .attr("markerHeight", 8)
                .attr("orient", "auto")
                .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .attr("fill", "#ff6600");
            
            // Dimmed arrow
            defs.append("marker")
                .attr("id", "arrowhead-dimmed")
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", 8)
                .attr("refY", 0)
                .attr("markerWidth", 8)
                .attr("markerHeight", 8)
                .attr("orient", "auto")
                .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .attr("fill", "#ccc");
        }
        
        // Enhanced event handlers
        function handleEnhancedNodeClick(event, d) {
            event.stopPropagation();
            highlightEnhancedDirectPath(d);
        }
        
        function handleEnhancedMouseOver(event, d) {
            const depInfo = graphData.dependencies[d.id];
            const imports = depInfo.imports || [];
            const importNames = imports.map(id => {
                const dep = graphData.dependencies[id];
                return dep ? dep.stem : id;
            }).join(", ");
            
            const importanceLevel = d.importance > 0.7 ? "High" : 
                                  d.importance > 0.5 ? "Medium" : 
                                  d.importance > 0.3 ? "Low" : "Minimal";
            
            tooltip.style("opacity", 1)
                .attr("aria-hidden", "false")
                .html(`
                    <strong>${d.stem}</strong><br/>
                    <strong>Folder:</strong> ${d.folder}<br/>
                    <strong>Importance:</strong> ${importanceLevel} (${(d.importance * 100).toFixed(1)}%)<br/>
                    <strong>Dependencies:</strong> ${imports.length}<br/>
                    <strong>File Size:</strong> ${(d.size / 1024).toFixed(1)}KB<br/>
                    ${d.is_test ? "<strong>Type:</strong> Test File<br/>" : ""}
                    <strong>Imports:</strong> ${importNames || "None"}
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }
        
        function handleEnhancedMouseOut() {
            tooltip.style("opacity", 0).attr("aria-hidden", "true");
        }
        
        // Enhanced highlighting
        function highlightEnhancedDirectPath(clickedNode) {
            selectedNode = clickedNode;
            const connected = findEnhancedConnections(clickedNode.id);
            
            // Reset all elements
            window.graphElements.node.classed("dimmed highlighted", false);
            window.graphElements.node.selectAll(".node-rect").classed("dimmed highlighted", false);
            window.graphElements.link
                .classed("dimmed highlighted", false)
                .attr("marker-end", "url(#arrowhead)");
            
            // Apply highlighting
            window.graphElements.node
                .classed("highlighted", d => connected.has(d.id))
                .classed("dimmed", d => !connected.has(d.id));
            
            window.graphElements.node.selectAll(".node-rect")
                .classed("highlighted", function() {
                    const nodeData = d3.select(this.parentNode).datum();
                    return connected.has(nodeData.id);
                })
                .classed("dimmed", function() {
                    const nodeData = d3.select(this.parentNode).datum();
                    return !connected.has(nodeData.id);
                });
            
            window.graphElements.link
                .classed("highlighted", d => connected.has(d.source_name) && connected.has(d.target_name))
                .classed("dimmed", d => !(connected.has(d.source_name) && connected.has(d.target_name)))
                .attr("marker-end", d => {
                    if (connected.has(d.source_name) && connected.has(d.target_name)) {
                        return "url(#arrowhead-highlighted)";
                    } else if (!(connected.has(d.source_name) && connected.has(d.target_name))) {
                        return "url(#arrowhead-dimmed)";
                    } else {
                        return "url(#arrowhead)";
                    }
                });
            
            highlightedNodes = connected;
        }
        
        function findEnhancedConnections(nodeId) {
            const connected = new Set([nodeId]);
            
            // Find all connections respecting current filters
            graphData.edges.forEach(edge => {
                if (!shouldShowEdge(edge)) return;
                
                if (edge.source_name === nodeId) {
                    connected.add(edge.target_name);
                }
                if (edge.target_name === nodeId) {
                    connected.add(edge.source_name);
                }
            });
            
            return connected;
        }
        
        function resetHighlighting() {
            selectedNode = null;
            highlightedNodes.clear();
            window.graphElements.node.classed("dimmed highlighted", false);
            window.graphElements.node.selectAll(".node-rect").classed("dimmed highlighted", false);
            window.graphElements.link
                .classed("dimmed highlighted", false)
                .attr("marker-end", "url(#arrowhead)");
        }
        
        // Enhanced controls
        function updateEnhancedControls() {
            const container = d3.select("#folder-controls");
            container.selectAll("*").remove();
            
            Object.entries(graphData.subfolder_info).forEach(([folder, info]) => {
                const item = container.append("div")
                    .attr("class", "folder-item")
                    .attr("role", "checkbox")
                    .attr("aria-checked", checkedFolders.has(folder))
                    .attr("tabindex", "0")
                    .on("click", () => toggleFolder(folder))
                    .on("keydown", function(event) {
                        if (event.key === "Enter" || event.key === " ") {
                            event.preventDefault();
                            toggleFolder(folder);
                        }
                    });
                
                item.append("span")
                    .attr("class", "folder-checkbox")
                    .text(checkedFolders.has(folder) ? "‚òë" : "‚òê");
                
                item.append("div")
                    .attr("class", "folder-color")
                    .style("background-color", info.color);
                
                const labelText = `${folder} <span class="folder-count">(${info.count} modules)</span>`;
                const testText = info.test_modules && info.test_modules.length > 0 ? 
                    ` <span class="test-count">[${info.test_modules.length} tests]</span>` : "";
                
                item.append("span")
                    .attr("class", "folder-label")
                    .html(labelText + testText);
            });
            
            // Test toggle
            const testToggle = d3.select("#test-toggle");
            testToggle.select(".folder-checkbox")
                .text(showTestDependencies ? "‚òë" : "‚òê");
            
            testToggle.on("click", toggleTestDependencies);
            
            // Update "Select All" toggle
            const allFolders = Object.keys(graphData.subfolder_info);
            const allSelected = allFolders.every(folder => checkedFolders.has(folder));
            const selectAllToggle = d3.select("#select-all-toggle");
            selectAllToggle.select(".folder-checkbox")
                .text(allSelected ? "‚òë" : "‚òê");
        }
        
        function updateEnhancedStats() {
            const visibleNodes = graphData.nodes.filter(n => shouldShowNode(n));
            const visibleEdges = graphData.edges.filter(e => shouldShowEdge(e));
            const testFiles = visibleNodes.filter(n => n.is_test).length;
            const crossFolderEdges = visibleEdges.filter(e => e.is_cross_folder).length;
            
            const stats = [
                { value: graphData.nodes.length, label: "Total Files" },
                { value: visibleNodes.length, label: "Visible Files" },
                { value: graphData.edges.length, label: "Dependencies" },
                { value: visibleEdges.length, label: "Visible Deps" },
                { value: Object.keys(graphData.subfolder_info).length, label: "Directories" },
                { value: testFiles, label: "Test Files" }
            ];
            
            const container = d3.select("#stats-content");
            container.selectAll("*").remove();
            
            stats.forEach(stat => {
                const item = container.append("div").attr("class", "stat-item");
                item.append("div").attr("class", "stat-value").text(stat.value);
                item.append("div").attr("class", "stat-label").text(stat.label);
            });
        }
        
        function updateEnhancedVisibility() {
            if (!window.graphElements) return;
            
            // Update node visibility with advanced filtering
            window.graphElements.node
                .style("opacity", d => {
                    if (!shouldShowNode(d)) return 0.1;
                    if (!showTestDependencies && d.is_test) return 0.3;
                    return 1;
                })
                .style("display", d => shouldShowNode(d) ? "block" : "none");
            
            // Update link visibility
            window.graphElements.link
                .classed("hidden", d => !shouldShowEdge(d))
                .style("opacity", d => {
                    if (!shouldShowEdge(d)) return 0;
                    return d.is_test_related && !showTestDependencies ? 0.3 : 0.8;
                });
        }
        
        function toggleFolder(folder) {
            if (checkedFolders.has(folder)) {
                checkedFolders.delete(folder);
            } else {
                checkedFolders.add(folder);
            }
            updateEnhancedControls();
            updateEnhancedVisibility();
            updateEnhancedStats();
        }
        
        function toggleTestDependencies() {
            showTestDependencies = !showTestDependencies;
            updateEnhancedControls();
            updateEnhancedVisibility();
            updateEnhancedStats();
        }
        
        function resetAllFilters() {
            checkedFolders = new Set(Object.keys(graphData.subfolder_info));
            showTestDependencies = true;
            
            // Reset advanced filters
            maxImportsFilter = 20;
            maxDependenciesFilter = 20;
            maxSizeFilter = 100;
            
            // Update UI controls
            document.getElementById('imports-filter').value = maxImportsFilter;
            document.getElementById('dependencies-filter').value = maxDependenciesFilter;
            document.getElementById('size-filter').value = maxSizeFilter;
            updateFilterLabels();
            
            resetHighlighting();
            updateEnhancedControls();
            updateEnhancedVisibility();
            updateEnhancedStats();
        }
        
        // Advanced filter functions
        function updateFilterLabels() {
            document.getElementById('imports-filter-value').textContent = maxImportsFilter;
            document.getElementById('dependencies-filter-value').textContent = maxDependenciesFilter;
            document.getElementById('size-filter-value').textContent = maxSizeFilter;
        }
        
        function setupAdvancedFilters() {
            // Imports filter
            const importsSlider = document.getElementById('imports-filter');
            importsSlider.addEventListener('input', function() {
                maxImportsFilter = parseInt(this.value);
                updateFilterLabels();
                updateEnhancedVisibility();
                updateEnhancedStats();
            });
            
            // Dependencies filter  
            const dependenciesSlider = document.getElementById('dependencies-filter');
            dependenciesSlider.addEventListener('input', function() {
                maxDependenciesFilter = parseInt(this.value);
                updateFilterLabels();
                updateEnhancedVisibility();
                updateEnhancedStats();
            });
            
            // Size filter
            const sizeSlider = document.getElementById('size-filter');
            sizeSlider.addEventListener('input', function() {
                maxSizeFilter = parseInt(this.value);
                updateFilterLabels();
                updateEnhancedVisibility();
                updateEnhancedStats();
            });
            
            // Select all toggle
            const selectAllToggle = document.getElementById('select-all-toggle');
            selectAllToggle.addEventListener('click', function() {
                const allFolders = Object.keys(graphData.subfolder_info);
                const allSelected = allFolders.every(folder => checkedFolders.has(folder));
                
                if (allSelected) {
                    checkedFolders.clear();
                } else {
                    checkedFolders = new Set(allFolders);
                }
                
                updateEnhancedControls();
                updateEnhancedVisibility();
                updateEnhancedStats();
            });
            
            updateFilterLabels();
        }
        
        function shouldShowNode(node) {
            // Check folder visibility
            if (!checkedFolders.has(node.folder)) return false;
            
            // Check advanced filters
            if (node.imports_count > maxImportsFilter) return false;
            
            // Count outgoing dependencies
            const outgoingDeps = graphData.edges.filter(e => e.source_name === node.id).length;
            if (outgoingDeps > maxDependenciesFilter) return false;
            
            // Check file size (convert bytes to KB)
            const sizeKB = node.size / 1024;
            if (sizeKB > maxSizeFilter) return false;
            
            return true;
        }
        
        // Enhanced drag functions with layout awareness
        function dragstarted(event, d) {
            if (currentLayout === "force" && simulation) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
            }
            d.fx = d.x;
            d.fy = d.y;
        }
        
        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
            d.x = event.x;
            d.y = event.y;
            
            if (currentLayout === "hierarchical") {
                updatePositions();
            }
            // For force layout, the simulation handles position updates
        }
        
        function dragended(event, d) {
            if (currentLayout === "force" && simulation) {
                if (!event.active) simulation.alphaTarget(0);
            }
            d.fx = null;
            d.fy = null;
        }
        
        function updatePositions() {
            const { node, link } = window.graphElements;
            if (!node || !link) return;
            
            node.attr("transform", d => `translate(${d.x},${d.y})`);
            
            if (currentLayout === "hierarchical") {
                link.attr("d", d => createEnhancedCubicBezierPath(d));
            } else {
                // For force layout, use the force layout position update
                updatePositionsForceLayout();
            }
        }
        
        // Initialize on load
        window.addEventListener("resize", updateDimensions);
        document.addEventListener("DOMContentLoaded", initializeEnhancedVisualization);
    </script>
</body>
</html>