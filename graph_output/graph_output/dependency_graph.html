<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Dependency Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .container {
            display: flex;
            gap: 20px;
            height: calc(100vh - 40px);
        }
        
        .sidebar {
            width: 300px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow-y: auto;
        }
        
        .graph-container {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .sidebar h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        
        .folder-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .folder-item:hover {
            background-color: #f0f0f0;
        }
        
        .folder-checkbox {
            margin-right: 10px;
            font-size: 16px;
            user-select: none;
        }
        
        .folder-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin-right: 10px;
            border: 1px solid #ccc;
        }
        
        .folder-label {
            flex: 1;
            font-size: 14px;
        }
        
        .folder-count {
            font-size: 12px;
            color: #666;
            font-weight: normal;
        }
        
        .instructions {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fd;
            border-radius: 4px;
            font-size: 13px;
            color: #0c5460;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #0c5460;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .node.dimmed {
            opacity: 0.2;
        }
        
        .node.highlighted {
            opacity: 1;
            stroke: #ff6600;
            stroke-width: 3px;
        }
        
        .link {
            fill: none;
            stroke: #999;
            stroke-width: 1.5;
            transition: all 0.2s ease;
        }
        
        .link.dimmed {
            opacity: 0.1;
        }
        
        .link.highlighted {
            stroke: #ff6600;
            stroke-width: 3px;
            opacity: 1;
        }
        
        .link.hidden {
            opacity: 0;
        }
        
        .node-label {
            font-size: 12px;
            font-family: Arial, sans-serif;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
            fill: #333;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .stats {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .stats h3 {
            margin-top: 0;
            color: #333;
        }
        
        .reset-button {
            width: 100%;
            padding: 10px;
            background-color: #007acc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
        }
        
        .reset-button:hover {
            background-color: #005a9e;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
            }
            
            .sidebar {
                width: auto;
                order: 2;
            }
            
            .graph-container {
                height: 60vh;
                order: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>Folder Legend</h2>
            <div id="folder-controls" role="group" aria-label="Folder filtering controls"></div>
            
            <div class="instructions">
                <h3>Instructions</h3>
                <ul>
                    <li>Click any node to highlight its direct path connections</li>
                    <li>Toggle folder checkboxes to show/hide modules</li>
                    <li>Click empty space to reset highlighting</li>
                    <li>Hover nodes for details</li>
                </ul>
            </div>
            
            <div class="stats" id="stats" role="region" aria-label="Graph statistics">
                <h3>Statistics</h3>
                <div id="stats-content"></div>
            </div>
            
            <button class="reset-button" onclick="resetAllFilters()"
                    aria-label="Reset all folder filters">Reset All Filters</button>
        </div>
        
        <div class="graph-container">
            <svg id="graph" width="100%" height="100%" role="img" aria-label="Dependency graph visualization"></svg>
            <div class="tooltip" id="tooltip" role="tooltip" aria-hidden="true"></div>
        </div>
    </div>

    <script>
        // Graph data
        const graphData = {
  "nodes": [
    {
      "id": "generate_dependency_graph - Copy (2)",
      "name": "generate_dependency_graph - Copy (2)",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "generate_dependency_graph - Copy (2).py",
      "imports_count": 0,
      "index": 0
    },
    {
      "id": "generate_dependency_graph - Copy (3)",
      "name": "generate_dependency_graph - Copy (3)",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "generate_dependency_graph - Copy (3).py",
      "imports_count": 0,
      "index": 1
    },
    {
      "id": "generate_dependency_graph",
      "name": "generate_dependency_graph",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "generate_dependency_graph.py",
      "imports_count": 0,
      "index": 2
    },
    {
      "id": "html_dependency_graph - Copy",
      "name": "html_dependency_graph - Copy",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "html_dependency_graph - Copy.py",
      "imports_count": 0,
      "index": 3
    },
    {
      "id": "html_dependency_graph",
      "name": "html_dependency_graph",
      "folder": "root",
      "color": "#E3F2FD",
      "file_path": "html_dependency_graph.py",
      "imports_count": 0,
      "index": 4
    }
  ],
  "edges": [],
  "subfolder_info": {
    "root": {
      "color": "#E3F2FD",
      "modules": [
        "generate_dependency_graph - Copy (2)",
        "generate_dependency_graph - Copy (3)",
        "generate_dependency_graph",
        "html_dependency_graph - Copy",
        "html_dependency_graph"
      ]
    }
  },
  "dependencies": {
    "generate_dependency_graph - Copy (2)": {
      "imports": [],
      "file_path": "generate_dependency_graph - Copy (2).py",
      "folder": "root"
    },
    "generate_dependency_graph - Copy (3)": {
      "imports": [],
      "file_path": "generate_dependency_graph - Copy (3).py",
      "folder": "root"
    },
    "generate_dependency_graph": {
      "imports": [],
      "file_path": "generate_dependency_graph.py",
      "folder": "root"
    },
    "html_dependency_graph - Copy": {
      "imports": [],
      "file_path": "html_dependency_graph - Copy.py",
      "folder": "root"
    },
    "html_dependency_graph": {
      "imports": [],
      "file_path": "html_dependency_graph.py",
      "folder": "root"
    }
  }
};
        
        // State management
        let checkedFolders = new Set(Object.keys(graphData.subfolder_info));
        let selectedNode = null;
        let highlightedNodes = new Set();
        
        // D3.js setup
        const svg = d3.select("#graph");
        const tooltip = d3.select("#tooltip");
        let width, height;
        
        function updateDimensions() {
            const container = document.querySelector('.graph-container');
            width = container.clientWidth;
            height = container.clientHeight;
            svg.attr("width", width).attr("height", height);
        }
        
        // Initialize visualization
        function initializeVisualization() {
            updateDimensions();
            
            // Create main graph group
            const g = svg.append("g");
            
            // Add zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.1, 4])
                .on("zoom", (event) => {
                    g.attr("transform", event.transform);
                });
            
            svg.call(zoom);
            
            // Create force simulation
            const simulation = d3.forceSimulation(graphData.nodes)
                .force("link", d3.forceLink(graphData.edges).id(d => d.index).distance(100))
                .force("charge", d3.forceManyBody().strength(-300))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide().radius(30));
            
            // Create links
            const link = g.append("g")
                .selectAll("line")
                .data(graphData.edges)
                .enter().append("line")
                .attr("class", "link");
            
            // Create nodes
            const node = g.append("g")
                .selectAll("g")
                .data(graphData.nodes)
                .enter().append("g")
                .attr("class", "node")
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));
            
            // Add circles to nodes
            node.append("circle")
                .attr("r", 20)
                .attr("fill", d => d.color)
                .attr("stroke", "#333")
                .attr("stroke-width", 1.5);
            
            // Add labels to nodes
            node.append("text")
                .attr("class", "node-label")
                .text(d => d.name)
                .attr("dy", "0.3em");
            
            // Add event listeners
            node.on("click", handleNodeClick)
                .on("mouseover", handleMouseOver)
                .on("mouseout", handleMouseOut);
            
            svg.on("click", function(event) {
                if (event.target === this) {
                    resetHighlighting();
                }
            });
            
            // Update simulation
            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);
                
                node.attr("transform", d => `translate(${d.x},${d.y})`);
            });
            
            // Store references for global access
            window.graphElements = { simulation, node, link, g };
            
            // Initial updates
            updateFolderControls();
            updateStats();
            updateVisibility();
        }
        
        // Event handlers
        function handleNodeClick(event, d) {
            event.stopPropagation();
            highlightDirectPath(d);
        }
        
        function handleMouseOver(event, d) {
            const imports = graphData.dependencies[d.name].imports;
            tooltip.style("opacity", 1)
                .attr("aria-hidden", "false")
                .html(`
                    <strong>${d.name}</strong><br/>
                    Folder: ${d.folder}<br/>
                    Imports: ${imports.length}<br/>
                    Dependencies: ${imports.join(", ") || "None"}
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }
        
        function handleMouseOut() {
            tooltip.style("opacity", 0)
                .attr("aria-hidden", "true");
        }
        
        // Drag functions
        function dragstarted(event, d) {
            if (!event.active) window.graphElements.simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }
        
        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }
        
        function dragended(event, d) {
            if (!event.active) window.graphElements.simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
        
        // Core functionality
        function highlightDirectPath(clickedNode) {
            selectedNode = clickedNode;
            const connected = findDirectPath(clickedNode.name);
            
            // Reset all
            window.graphElements.node.classed("dimmed highlighted", false);
            window.graphElements.link.classed("dimmed highlighted", false);
            
            // Highlight connected nodes
            window.graphElements.node
                .classed("highlighted", d => connected.has(d.name))
                .classed("dimmed", d => !connected.has(d.name));
            
            // Highlight connected edges
            window.graphElements.link
                .classed("highlighted", d => connected.has(d.source_name) && connected.has(d.target_name))
                .classed("dimmed", d => !(connected.has(d.source_name) && connected.has(d.target_name)));
            
            highlightedNodes = connected;
        }
        
        function findDirectPath(nodeId) {
            const connected = new Set([nodeId]);
            const edges = graphData.edges;
            
            // Build adjacency lists
            const outgoing = new Map();
            const incoming = new Map();
            
            edges.forEach(edge => {
                const from = edge.source_name;
                const to = edge.target_name;
                
                if (!outgoing.has(from)) outgoing.set(from, []);
                if (!incoming.has(to)) incoming.set(to, []);
                
                outgoing.get(from).push(to);
                incoming.get(to).push(from);
            });
            
            // Follow direct path forward
            let current = nodeId;
            while (outgoing.has(current) && outgoing.get(current).length === 1) {
                const next = outgoing.get(current)[0];
                connected.add(next);
                current = next;
            }
            
            // Follow direct path backward
            current = nodeId;
            while (incoming.has(current) && incoming.get(current).length === 1) {
                const prev = incoming.get(current)[0];
                connected.add(prev);
                current = prev;
            }
            
            return connected;
        }
        
        function resetHighlighting() {
            selectedNode = null;
            highlightedNodes.clear();
            window.graphElements.node.classed("dimmed highlighted", false);
            window.graphElements.link.classed("dimmed highlighted", false);
        }
        
        function toggleFolder(folder) {
            if (checkedFolders.has(folder)) {
                checkedFolders.delete(folder);
            } else {
                checkedFolders.add(folder);
            }
            updateFolderControls();
            updateVisibility();
            updateStats();
        }
        
        function updateFolderControls() {
            const container = d3.select("#folder-controls");
            container.selectAll("*").remove();
            
            Object.entries(graphData.subfolder_info).forEach(([folder, info]) => {
                const item = container.append("div")
                    .attr("class", "folder-item")
                    .attr("role", "checkbox")
                    .attr("aria-checked", checkedFolders.has(folder))
                    .attr("tabindex", "0")
                    .on("click", () => toggleFolder(folder))
                    .on("keydown", function(event) {
                        if (event.key === "Enter" || event.key === " ") {
                            event.preventDefault();
                            toggleFolder(folder);
                        }
                    });
                
                item.append("span")
                    .attr("class", "folder-checkbox")
                    .text(checkedFolders.has(folder) ? "☑" : "☐");
                
                item.append("div")
                    .attr("class", "folder-color")
                    .style("background-color", info.color);
                
                item.append("span")
                    .attr("class", "folder-label")
                    .html(`${folder} <span class="folder-count">(${info.modules.length} modules)</span>`);
            });
        }
        
        function updateVisibility() {
            if (!window.graphElements) return;
            
            // Update nodes
            window.graphElements.node
                .style("opacity", d => checkedFolders.has(d.folder) ? 1 : 0.1);
            
            // Update links
            window.graphElements.link
                .classed("hidden", d => !checkedFolders.has(d.source_folder) || !checkedFolders.has(d.target_folder));
        }
        
        function updateStats() {
            const visibleNodes = graphData.nodes.filter(n => checkedFolders.has(n.folder));
            const visibleEdges = graphData.edges.filter(e => 
                checkedFolders.has(e.source_folder) && checkedFolders.has(e.target_folder)
            );
            
            const stats = `
                <div>Total Modules: ${graphData.nodes.length}</div>
                <div>Visible Modules: ${visibleNodes.length}</div>
                <div>Total Dependencies: ${graphData.edges.length}</div>
                <div>Visible Dependencies: ${visibleEdges.length}</div>
                <div>Folders: ${Object.keys(graphData.subfolder_info).length}</div>
                <div>Active Folders: ${checkedFolders.size}</div>
            `;
            
            document.getElementById("stats-content").innerHTML = stats;
        }
        
        function resetAllFilters() {
            checkedFolders = new Set(Object.keys(graphData.subfolder_info));
            resetHighlighting();
            updateFolderControls();
            updateVisibility();
            updateStats();
        }
        
        // Initialize on load
        window.addEventListener("resize", updateDimensions);
        document.addEventListener("DOMContentLoaded", initializeVisualization);
    </script>
</body>
</html>